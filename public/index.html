<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ Emojis == Movie</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        retro: {
                            purple: '#8B5CF6',
                            pink: '#EC4899',
                            cyan: '#06B6D4',
                            yellow: '#FBBF24',
                        }
                    },
                    fontFamily: {
                        'game': ['Press Start 2P', 'monospace'],
                        'pixel': ['Courier New', 'monospace']
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            image-rendering: pixelated;
        }
        
        .pixel-border {
            box-shadow: 
                0 0 0 2px currentColor,
                4px 0 0 2px currentColor,
                -4px 0 0 2px currentColor,
                0 4px 0 2px currentColor,
                0 -4px 0 2px currentColor;
        }
        
        .retro-shadow {
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .bounce-in {
            animation: bounceIn 0.6s;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .confetti {
            animation: confetti 1s ease-out;
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.8); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-pink-900 to-cyan-900 min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Confetti Component
        const Confetti = ({ emojis = ['üéâ', 'üéä', 'üé¨', 'üåü', '‚ú®', 'üéØ'] }) => {
            const [particles, setParticles] = useState([]);
            
            useEffect(() => {
                const newParticles = Array.from({ length: 20 }, (_, i) => ({
                    id: i,
                    emoji: emojis[Math.floor(Math.random() * emojis.length)],
                    left: Math.random() * 100,
                    delay: Math.random() * 0.5
                }));
                setParticles(newParticles);
                
                const timer = setTimeout(() => setParticles([]), 1500);
                return () => clearTimeout(timer);
            }, []);
            
            return (
                <div className="fixed inset-0 pointer-events-none z-50">
                    {particles.map(p => (
                        <div
                            key={p.id}
                            className="confetti absolute text-4xl"
                            style={{
                                left: `${p.left}%`,
                                top: '50%',
                                animationDelay: `${p.delay}s`
                            }}
                        >
                            {p.emoji}
                        </div>
                    ))}
                </div>
            );
        };
        
        // Main App Component
        const EmojiMovieApp = () => {
            // State Management
            const [puzzle, setPuzzle] = useState(null);
            const [loading, setLoading] = useState(true);
            const [guess, setGuess] = useState('');
            const [gameState, setGameState] = useState('idle'); // idle, correct, incorrect, revealed, skipped
            const [hintsRevealed, setHintsRevealed] = useState([]);
            const [timer, setTimer] = useState(30);
            const [timerActive, setTimerActive] = useState(false);
            const [showConfetti, setShowConfetti] = useState(false);
            const [revealedAnswer, setRevealedAnswer] = useState(null);
            const [message, setMessage] = useState('');
            const [isDailyMode, setIsDailyMode] = useState(false);
            const [soundEnabled, setSoundEnabled] = useState(true);
            const [puzzleQueue, setPuzzleQueue] = useState([]);
            const [currentPuzzleIndex, setCurrentPuzzleIndex] = useState(0);
            
            const inputRef = useRef(null);
            
            // Load initial puzzles
            useEffect(() => {
                loadPuzzles();
            }, []);
            
            // Timer logic
            useEffect(() => {
                if (!timerActive || timer <= 0) return;
                
                const interval = setInterval(() => {
                    setTimer(prev => {
                        if (prev <= 1) {
                            setTimerActive(false);
                            handleTimeout();
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
                
                return () => clearInterval(interval);
            }, [timerActive, timer]);
            
            // Load puzzles from API
            const loadPuzzles = async (difficulty = null) => {
                try {
                    setLoading(true);
                    const url = difficulty 
                        ? `/api/puzzles?difficulty=${difficulty}&count=10`
                        : `/api/puzzles?count=10`;
                    const response = await fetch(url);
                    
                    if (!response.ok) throw new Error('Failed to load puzzles');
                    
                    const data = await response.json();
                    setPuzzleQueue(data);
                    setCurrentPuzzleIndex(0);
                    setPuzzle(data[0]);
                    resetPuzzleState();
                    setLoading(false);
                } catch (error) {
                    console.error('Error loading puzzles:', error);
                    setMessage('Error loading puzzles. Please refresh.');
                    setLoading(false);
                }
            };
            
            // Load daily puzzle
            const loadDailyPuzzle = async () => {
                try {
                    setLoading(true);
                    const response = await fetch('/api/daily');
                    
                    if (!response.ok) throw new Error('Failed to load daily puzzle');
                    
                    const data = await response.json();
                    setPuzzleQueue([data]);
                    setCurrentPuzzleIndex(0);
                    setPuzzle(data);
                    resetPuzzleState();
                    setLoading(false);
                    setIsDailyMode(true);
                } catch (error) {
                    console.error('Error loading daily puzzle:', error);
                    setMessage('Error loading daily puzzle. Please try again.');
                    setLoading(false);
                }
            };
            
            // Reset puzzle state
            const resetPuzzleState = () => {
                setGuess('');
                setGameState('idle');
                setHintsRevealed([]);
                setTimer(30);
                setTimerActive(true);
                setRevealedAnswer(null);
                setMessage('');
            };
            
            // Handle guess submission
            const handleSubmitGuess = async () => {
                if (!guess.trim() || gameState === 'revealed') return;
                
                try {
                    const response = await fetch('/api/guess', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            puzzle_id: puzzle.id,
                            guess: guess.trim()
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.correct) {
                        handleCorrectGuess(data);
                    } else {
                        handleIncorrectGuess();
                    }
                } catch (error) {
                    console.error('Error checking guess:', error);
                    setMessage('Error checking answer. Please try again.');
                }
            };
            
            // Handle correct guess
            const handleCorrectGuess = (data) => {
                setTimerActive(false);
                setGameState('correct');
                setMessage(data.message);
                setShowConfetti(true);
                
                setTimeout(() => setShowConfetti(false), 1500);
            };
            
            // Handle incorrect guess
            const handleIncorrectGuess = () => {
                setGameState('incorrect');
                setMessage('Not quite! Try again or use a hint.');
                
                // Trigger shake animation
                setTimeout(() => {
                    if (gameState === 'incorrect') setGameState('idle');
                }, 500);
            };
            
            // Handle timeout
            const handleTimeout = () => {
                setGameState('revealed');
                setMessage('Time\'s up! Here\'s the answer:');
                revealAnswer();
            };
            
            // Reveal hint
            const revealHint = () => {
                const availableHints = ['year', 'genre', 'firstLetter'].filter(
                    h => !hintsRevealed.includes(h)
                );
                
                if (availableHints.length > 0) {
                    const nextHint = availableHints[0];
                    setHintsRevealed(prev => [...prev, nextHint]);
                    
                    const hintMessages = {
                        year: `Hint revealed: Year = ${puzzle.year}`,
                        genre: `Hint revealed: Genre = ${puzzle.genre.join(', ')}`,
                        firstLetter: `Hint revealed: First letter = ${puzzle.emojis[0]}`
                    };
                    
                    setMessage(hintMessages[nextHint]);
                    setTimeout(() => setMessage(''), 3000);
                }
            };
            
            // Reveal answer
            const revealAnswer = async () => {
                try {
                    const response = await fetch(`/api/reveal/${puzzle.id}`);
                    const data = await response.json();
                    setRevealedAnswer(data);
                    setTimerActive(false);
                    setGameState('revealed');
                } catch (error) {
                    console.error('Error revealing answer:', error);
                }
            };
            
            // Skip puzzle
            const handleSkip = () => {
                revealAnswer();
                setMessage('Answer revealed.');
            };
            
            // Next puzzle
            const handleNext = () => {
                if (currentPuzzleIndex < puzzleQueue.length - 1) {
                    const nextIndex = currentPuzzleIndex + 1;
                    setCurrentPuzzleIndex(nextIndex);
                    setPuzzle(puzzleQueue[nextIndex]);
                    resetPuzzleState();
                } else {
                    // Load more puzzles
                    loadPuzzles();
                }
            };
            
            // New game
            const handleNewGame = () => {
                setIsDailyMode(false);
                loadPuzzles();
            };
            
            // Keyboard support for Enter key
            useEffect(() => {
                const handleKeyPress = (e) => {
                    if (e.key === 'Enter' && guess.trim()) {
                        handleSubmitGuess();
                    }
                };
                
                window.addEventListener('keydown', handleKeyPress);
                return () => window.removeEventListener('keydown', handleKeyPress);
            }, [guess]);
            
            // Loading state
            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-6xl mb-4 animate-pulse">üîéüé¨</div>
                            <div className="text-white text-xl font-pixel">Loading puzzles...</div>
                        </div>
                    </div>
                );
            }
            
            if (!puzzle) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center text-white">
                            <div className="text-4xl mb-4">üòï</div>
                            <div className="text-xl font-pixel">No puzzles loaded</div>
                            <button 
                                onClick={() => loadPuzzles()}
                                className="mt-4 px-6 py-3 bg-retro-purple text-white font-pixel rounded-lg hover:bg-purple-600"
                            >
                                Retry
                            </button>
                        </div>
                    </div>
                );
            }
            
            // Main UI
            return (
                <div className="min-h-screen p-4 md:p-8">
                    {showConfetti && <Confetti />}
                    
                    {/* Header */}
                    <header className="text-center mb-8">
                        <h1 className="text-4xl md:text-6xl font-bold text-white mb-2" style={{ textShadow: '4px 4px 0 rgba(0,0,0,0.5)' }}>
                            üé¨ Emojis == Movie
                        </h1>
                        <p className="text-retro-cyan text-sm md:text-lg font-pixel">
                            Guess the film title from the emoji sequence
                        </p>
                    </header>
                    
                    {/* Main Game Layout */}
                    <div className="max-w-6xl mx-auto grid md:grid-cols-2 gap-6">
                        {/* LEFT: Puzzle Card */}
                        <div className={`bg-gradient-to-br from-purple-600 to-pink-600 p-8 rounded-xl retro-shadow border-4 border-white ${
                            gameState === 'incorrect' ? 'shake' : ''
                        }`}>
                            {/* Emoji Display */}
                            <div className="bg-white/90 rounded-lg p-8 mb-6 text-center">
                                <div className="text-7xl md:text-8xl mb-4 bounce-in" key={puzzle.id}>
                                    {puzzle.emojis}
                                </div>
                                <div className="sr-only">
                                    Emojis: {puzzle.emojis}
                                </div>
                            </div>
                            
                            {/* Hints Row */}
                            <div className="mb-6">
                                <div className="flex flex-wrap gap-2 justify-center">
                                    <div className={`px-4 py-2 rounded-full text-sm font-pixel border-2 transition ${
                                        hintsRevealed.includes('year')
                                            ? 'bg-retro-yellow text-black border-yellow-600'
                                            : 'bg-gray-800/50 text-gray-400 border-gray-600'
                                    }`}>
                                        Year: {hintsRevealed.includes('year') ? puzzle.year : '????'}
                                    </div>
                                    <div className={`px-4 py-2 rounded-full text-sm font-pixel border-2 transition ${
                                        hintsRevealed.includes('genre')
                                            ? 'bg-retro-yellow text-black border-yellow-600'
                                            : 'bg-gray-800/50 text-gray-400 border-gray-600'
                                    }`}>
                                        Genre: {hintsRevealed.includes('genre') ? puzzle.genre[0] : '????'}
                                    </div>
                                    <div className={`px-4 py-2 rounded-full text-sm font-pixel border-2 transition ${
                                        hintsRevealed.includes('firstLetter')
                                            ? 'bg-retro-yellow text-black border-yellow-600'
                                            : 'bg-gray-800/50 text-gray-400 border-gray-600'
                                    }`}>
                                        Starts: {hintsRevealed.includes('firstLetter') ? puzzle.emojis[0] : '‚ùì'}
                                    </div>
                                </div>
                            </div>
                            
                            {/* Timer and Difficulty */}
                            <div className="flex justify-between items-center mb-6">
                                <div className={`px-6 py-3 rounded-lg font-pixel text-lg ${
                                    timer <= 5 ? 'bg-red-500 text-white animate-pulse' : 'bg-white/90 text-gray-800'
                                }`}>
                                    ‚è±Ô∏è {timer}s
                                </div>
                                <div className={`px-6 py-3 rounded-lg font-pixel text-lg ${
                                    puzzle.difficulty === 'Easy' ? 'bg-green-500' :
                                    puzzle.difficulty === 'Medium' ? 'bg-yellow-500' :
                                    'bg-red-500'
                                } text-white`}>
                                    {puzzle.difficulty}
                                </div>
                            </div>
                            
                            {/* Controls */}
                            <div className="flex gap-3">
                                <button
                                    onClick={revealHint}
                                    disabled={hintsRevealed.length >= 3 || gameState === 'revealed'}
                                    className="flex-1 px-6 py-3 bg-yellow-500 text-black font-pixel rounded-lg hover:bg-yellow-600 disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed transition"
                                >
                                    üí° Hint
                                </button>
                                <button
                                    onClick={handleSkip}
                                    disabled={gameState === 'revealed'}
                                    className="flex-1 px-6 py-3 bg-gray-700 text-white font-pixel rounded-lg hover:bg-gray-600 disabled:bg-gray-800 disabled:cursor-not-allowed transition"
                                >
                                    ‚è≠Ô∏è Skip
                                </button>
                            </div>
                            
                            {/* Revealed Answer Display */}
                            {revealedAnswer && (
                                <div className="mt-6 bg-white/90 p-6 rounded-lg bounce-in">
                                    <h3 className="text-2xl font-bold text-gray-800 mb-2">
                                        {revealedAnswer.title}
                                    </h3>
                                    <p className="text-gray-600 mb-2">
                                        {revealedAnswer.year} ‚Ä¢ {revealedAnswer.genre.join(', ')}
                                    </p>
                                    <p className="text-gray-700 text-sm italic">
                                        {revealedAnswer.explanation}
                                    </p>
                                </div>
                            )}
                        </div>
                        
                        {/* RIGHT: Answer/Meta Card */}
                        <div className="bg-gradient-to-br from-cyan-600 to-blue-600 p-8 rounded-xl retro-shadow border-4 border-white">
                            {/* Input */}
                            <div className="mb-6">
                                <label className="block text-white font-pixel mb-2">
                                    Your Guess:
                                </label>
                                <input
                                    ref={inputRef}
                                    type="text"
                                    value={guess}
                                    onChange={(e) => setGuess(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSubmitGuess()}
                                    disabled={gameState === 'revealed'}
                                    placeholder="Type the movie title..."
                                    className="w-full px-4 py-3 rounded-lg font-pixel text-lg border-4 border-white focus:outline-none focus:ring-4 focus:ring-retro-yellow disabled:bg-gray-300"
                                />
                            </div>
                            
                            {/* Feedback Area */}
                            {message && (
                                <div className={`mb-6 p-4 rounded-lg font-pixel text-sm ${
                                    gameState === 'correct' ? 'bg-green-500 text-white' :
                                    gameState === 'incorrect' ? 'bg-red-500 text-white' :
                                    'bg-yellow-500 text-black'
                                } bounce-in`}>
                                    {message}
                                </div>
                            )}
                            
                            {/* Action Buttons */}
                            <div className="space-y-3 mb-6">
                                {gameState === 'correct' || gameState === 'revealed' ? (
                                    <button
                                        onClick={handleNext}
                                        className="w-full px-6 py-4 bg-retro-yellow text-black text-xl font-pixel rounded-lg hover:bg-yellow-600 transition pulse-glow"
                                    >
                                        ‚û°Ô∏è Next Puzzle
                                    </button>
                                ) : (
                                    <>
                                        <button
                                            onClick={handleSubmitGuess}
                                            disabled={!guess.trim()}
                                            className="w-full px-6 py-4 bg-retro-pink text-white text-xl font-pixel rounded-lg hover:bg-pink-600 disabled:bg-gray-600 disabled:cursor-not-allowed transition pulse-glow"
                                        >
                                            ‚úì Submit Guess
                                        </button>
                                        <button
                                            onClick={revealAnswer}
                                            className="w-full px-6 py-3 bg-gray-700 text-white font-pixel rounded-lg hover:bg-gray-600 transition"
                                        >
                                            üè≥Ô∏è Give Up / Show Answer
                                        </button>
                                    </>
                                )}
                            </div>
                            
                            {/* Progress Dots */}
                            <div className="flex justify-center gap-2 mb-6">
                                {puzzleQueue.slice(0, 10).map((_, idx) => (
                                    <div
                                        key={idx}
                                        className={`w-3 h-3 rounded-full ${
                                            idx < currentPuzzleIndex ? 'bg-green-500' :
                                            idx === currentPuzzleIndex ? 'bg-retro-yellow' :
                                            'bg-gray-400'
                                        }`}
                                    />
                                ))}
                            </div>
                            
                        </div>
                    </div>
                    
                    {/* Footer */}
                    <footer className="text-center mt-8 text-white/70 text-sm font-pixel">
                        Made with React + Tailwind ‚Äî FastAPI Backend
                    </footer>
                </div>
            );
        };
        
        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EmojiMovieApp />);
    </script>
</body>
</html>

